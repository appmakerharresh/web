<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Web Creator</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
tailwind.config = {
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        primary: "#0a66c2",
        "background-light": "#f5f7f8",
        "background-dark": "#101922",
      },
      fontFamily: {
        display: ["Space Grotesk"],
      },
    },
  },
};
</script>
<style>
.material-symbols-outlined { font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24; }
textarea { font-family: monospace; }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-300">

<div class="flex flex-col lg:flex-row h-screen w-full">
  <!-- Sidebar -->
  <div class="w-full lg:w-64 bg-background-light dark:bg-background-dark border-b lg:border-b-0 lg:border-r border-background-dark/10 dark:border-background-light/10 flex flex-col">
    <div class="p-2 border-b border-background-dark/10 dark:border-background-light/10 flex items-center justify-between">
      <h2 class="text-xs uppercase font-bold text-gray-500 dark:text-gray-400 px-2">Explorer</h2>
    </div>
    <div class="flex-grow p-2 overflow-y-auto">
      <div class="space-y-1">
        <div class="flex items-center space-x-2 cursor-pointer p-1 rounded hover:bg-primary/10">
          <span class="material-symbols-outlined text-lg">code</span>
          <span class="text-sm font-medium text-gray-800 dark:text-gray-200">index.html</span>
        </div>
        <div class="flex items-center space-x-2 cursor-pointer p-1 rounded hover:bg-primary/10">
          <span class="material-symbols-outlined text-lg text-blue-500">css</span>
          <span class="text-sm text-gray-600 dark:text-gray-400">styles.css</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Editor + Preview -->
  <main class="flex-1 flex flex-col lg:flex-row">
    <!-- Editor -->
    <div class="flex-1 flex flex-col border-b lg:border-b-0 lg:border-r border-background-dark/10 dark:border-background-light/10">
      <div class="border-b border-background-dark/10 dark:border-background-light/10 p-2 flex items-center justify-between bg-background-light dark:bg-background-dark">
        <span class="font-medium text-gray-800 dark:text-gray-200">HTML Editor</span>
        <div class="flex space-x-2">
          <button onclick="generateURL()" class="px-3 py-1 bg-primary text-white rounded hover:bg-blue-700">Generate URL</button>
        </div>
      </div>
      <textarea id="htmlInput" class="flex-1 p-4 bg-background-light dark:bg-background-dark text-gray-800 dark:text-gray-300" placeholder="Paste your full HTML here"></textarea>
      <input type="text" id="shortURL" placeholder="Short URL appears here" class="p-2 border-t border-background-dark/10 dark:border-background-light/10 w-full" readonly/>
    </div>

    <!-- Live Preview -->
    <div class="flex-1 flex flex-col">
      <div class="border-b border-background-dark/10 dark:border-background-light/10 p-2 flex items-center justify-between bg-background-light dark:bg-background-dark">
        <span class="font-medium text-gray-800 dark:text-gray-200">Live Preview</span>
        <div class="flex space-x-2">
          <button onclick="refreshPreview()" class="px-3 py-1 bg-primary text-white rounded hover:bg-blue-700">Refresh</button>
          <button onclick="openPreview()" class="px-3 py-1 bg-primary text-white rounded hover:bg-blue-700">Open in New Tab</button>
        </div>
      </div>
      <iframe id="previewFrame" class="flex-1 w-full"></iframe>
    </div>
  </main>
</div>

<script>
async function generateURL() {
  const html = document.getElementById('htmlInput').value.trim();
  if (!html) return alert("Enter HTML!");

  const encoded = encodeURIComponent(html);
  const fullURL = `${location.origin}/web/#/${encoded}`;

  try {
    const res = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(fullURL)}`);
    const shortURL = await res.text();
    document.getElementById('shortURL').value = shortURL;
    await navigator.clipboard.writeText(shortURL);
    alert("Short URL copied to clipboard!");
    refreshPreview();
  } catch(e) {
    alert("Error creating short URL: " + e);
  }
}

function refreshPreview() {
  const iframe = document.getElementById('previewFrame');
  const html = document.getElementById('htmlInput').value;
  const doc = iframe.contentDocument || iframe.contentWindow.document;
  doc.open();
  doc.write(html);
  doc.close();
}

function openPreview() {
  const html = document.getElementById('htmlInput').value;
  const encoded = encodeURIComponent(html);
  const url = `${location.origin}/web/#/${encoded}`;
  window.open(url, "_blank");
}
</script>

</body>
</html>
